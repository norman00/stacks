

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Database Reference Stack with Cassandra &mdash; System Stacks for Linux* OS  documentation</title>
  

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script src="../../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Configuration files" href="cassandra-pmem-helm/files/conf/README.html" />
    <link rel="prev" title="Additional details on licenses" href="../redis/licenses/README.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home" alt="Documentation Home"> System Stacks for Linux* OS
          

          
            
            <img src="../../../_static/stacks_logo.png" class="logo" alt="Logo"/>
          
          </a>

          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../README.html">System Stacks for Linux* OS</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../README.html#contributing">Contributing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../README.html#security-issues">Security Issues</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../README.html#mailing-list">Mailing List</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../dlrs/index.html">Deep Learning Reference Stack</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../dlrs/index.html#overview">Overview</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../dlrs/README.html">Deep Learning Reference Stack README</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../dlrs/clearlinux/releasenote.html">Deep Learning Reference Stack Release Notes</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../dlrs/clearlinux/releasenote.html#the-deep-learning-reference-stack-release">The Deep Learning Reference Stack Release</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../dlrs/clearlinux/releasenote.html#licensing">Licensing</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../dlrs/clearlinux/releasenote.html#working-with-the-deep-learning-reference-stack">Working with the Deep Learning Reference Stack</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../dlrs/clearlinux/releasenote.html#performance-tuning-configurations">Performance tuning configurations</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../dlrs/clearlinux/releasenote.html#contributing-to-the-deep-learning-reference-stack">Contributing to the Deep Learning Reference Stack</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../dlrs/clearlinux/releasenote.html#reporting-security-issues">Reporting Security Issues</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../dlrs/terms_of_use.html">Deep Learning Reference Stack Terms of Use</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../dlrs/index.html#guides">Guides</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../dlrs/dlrs.html">Deep Learning Reference Stack Guide</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../dlrs/dlrs.html#overview">Overview</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../dlrs/dlrs.html#releases">Releases</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../dlrs/dlrs.html#tensorflow-single-and-multi-node-benchmarks">TensorFlow single and multi-node benchmarks</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../dlrs/dlrs.html#pytorch-single-and-multi-node-benchmarks">PyTorch single and multi-node benchmarks</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../dlrs/dlrs.html#tensorflow-training-tfjob-with-kubeflow-and-dlrs">TensorFlow Training (TFJob) with Kubeflow and DLRS</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../dlrs/dlrs.html#pytorch-training-pytorch-job-with-kubeflow-and-dlrs">PyTorch Training (PyTorch Job) with Kubeflow and DLRS</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../dlrs/dlrs.html#working-with-horovod-and-openmpi">Working with Horovod* and OpenMPI*</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../dlrs/dlrs.html#using-transformers-for-natural-language-processing">Using Transformers* for Natural Language Processing</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../dlrs/dlrs.html#using-the-openvino-model-optimizer">Using the OpenVINO™ Model Optimizer</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../dlrs/dlrs.html#using-the-openvino-toolkit-inference-engine">Using the OpenVINO™ toolkit Inference Engine</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../dlrs/dlrs.html#using-seldon-and-openvino-model-server-with-the-deep-learning-reference-stack">Using Seldon and OpenVINO™ model server with the Deep Learning Reference Stack</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../dlrs/dlrs.html#use-jupyter-notebook">Use Jupyter Notebook</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../dlrs/dlrs.html#uninstallation">Uninstallation</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../dlrs/dlrs.html#compiling-aixprt-with-openmp-on-dlrs">Compiling AIXPRT with OpenMP on DLRS</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../dlrs/dlrs.html#related-topics">Related topics</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../dlrs/index.html#clear-linux-based-containers">Clear Linux based containers</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../dlrs/clearlinux/README.html">Deep Learning Reference Stack containers based on Clear Linux OS</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../dlrs/clearlinux/ml-compiler/README.html">System Stacks Deep Learning Compiler</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../dlrs/clearlinux/ml-compiler/README.html#building-locally">Building Locally</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../dlrs/clearlinux/ml-compiler/README.html#build-args">Build ARGs</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../dlrs/index.html#pytorch-versions">PyTorch versions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../dlrs/clearlinux/pytorch/mkl/README.html">Deep Learning Reference Stack with Pytorch and Intel® oneAPI Deep Neural Network Library (oneDNN)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../dlrs/clearlinux/pytorch/mkl/licenses/README.html">Additional details on licenses</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../dlrs/clearlinux/pytorch/oss/README.html">Deep Learning Reference Stack with Pytorch and OpenBLAS</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../dlrs/clearlinux/pytorch/oss/licenses/README.html">Additional details on licenses</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../dlrs/index.html#tensorflow-versions">TensorFlow versions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../dlrs/clearlinux/tensorflow/mkl/README.html">Deep Learning Reference Stack with TensorFlow and Intel® oneAPI Deep Neural Network Library (oneDNN)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../dlrs/clearlinux/tensorflow/mkl/licenses/README.html">Additional details on licenses</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../dlrs/clearlinux/tensorflow/mkl/scripts/README.html">Deep Learning Reference Stack Scripts</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../dlrs/clearlinux/tensorflow/oss/README.html">Deep Learning Reference Stack with Tensorflow and Optimized Eigen</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../dlrs/clearlinux/tensorflow/oss/licenses/README.html">Additional details on licenses</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../dlrs/clearlinux/tensorflow_2/mkl/README.html">Deep Learning Reference Stack with TensorFlow 2.0 and Intel® oneAPI Deep Neural Network Library (oneDNN)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../dlrs/clearlinux/tensorflow_2/mkl/licenses/README.html">Additional details on licenses</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../dlrs/clearlinux/tensorflow_2/mkl/scripts/README.html">Deep Learning Reference Stack Scripts</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../dars/index.html">Data Analytics Reference Stack</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../dars/index.html#overview">Overview</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../dars/clearlinux/releasenote.html">Data Analytics Reference Stack</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../dars/clearlinux/releasenote.html#stack-features">Stack Features</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../dars/clearlinux/releasenote.html#the-data-analytics-reference-stack-with-mkl">The Data Analytics Reference Stack with MKL</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../dars/clearlinux/releasenote.html#the-data-analytics-reference-stack-with-openblas">The Data Analytics Reference Stack with OpenBLAS</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../dars/clearlinux/releasenote.html#licensing">Licensing</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../dars/clearlinux/releasenote.html#working-with-the-data-analytics-reference-stack">Working with the Data Analytics Reference Stack</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../dars/clearlinux/releasenote.html#contributing-to-the-database-reference-stack">Contributing to the Database Reference Stack</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../dars/clearlinux/releasenote.html#reporting-security-issues">Reporting Security Issues</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../dars/terms_of_use.html">Data Analytics Reference Stack Terms of Use</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../dars/index.html#guide">Guide</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../dars/dars.html">Data Analytics Reference Stack Guide</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../dars/dars.html#overview">Overview</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../dars/dars.html#using-the-docker-images">Using the Docker images</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../dars/dars.html#using-apache-spark-in-dars">Using Apache Spark* in DARS</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../dars/dars.html#using-apache-hadoop-in-dars">Using Apache Hadoop in DARS</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../dars/dars.html#deploy-dars-on-kubernetes">Deploy DARS on Kubernetes*</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../dars/dars.html#troubleshooting">Troubleshooting</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../dars/index.html#clear-linux-based-containers">Clear Linux based containers</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../dars/clearlinux/README.html">Data Analytics Reference Stack</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../dars/index.html#openblas-versions">OpenBLAS versions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../dars/clearlinux/openblas/README.html">Data Analytics Reference Stack with OpenBLAS</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../dars/clearlinux/openblas/README.html#java-requirements">Java Requirements</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../dars/clearlinux/openblas/README.html#single-node-hadoop-cluster-setup">Single Node Hadoop Cluster Setup</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../dars/clearlinux/openblas/README.html#inside-the-running-container-we-need-to-edit-hadoop-configuration-files-as-follows">Inside the running container we need to edit hadoop configuration files as follows</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../dars/clearlinux/openblas/README.html#start-hadoop-daemons">Start Hadoop daemons</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../dars/clearlinux/openblas/README.html#single-node-spark-cluster-setup">Single Node Spark Cluster Setup</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../dars/clearlinux/openblas/README.html#run-the-pi-calculator-example-on-spark-shell">Run the Pi Calculator Example on spark-shell</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../dars/clearlinux/openblas/README.html#run-the-pi-calculator-example-on-pyspark">Run the Pi Calculator Example on pyspark</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../dars/clearlinux/openblas/README.html#deploy-dars-on-kubernetes">Deploy DARS on Kubernetes</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../dars/clearlinux/openblas/README.html#kubernetes-installation">Kubernetes installation</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../dars/clearlinux/openblas/README.html#faq"><strong>FAQ</strong></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../dars/clearlinux/openblas/licenses/README.html">Additional details on licenses</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../dars/index.html#mkl-versions">MKL versions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../dars/clearlinux/mkl/README.html">Data Analytics Reference Stack with Intel® MKL</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../dars/clearlinux/mkl/README.html#java-requirements">Java Requirements</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../dars/clearlinux/mkl/README.html#single-node-hadoop-cluster-setup">Single Node Hadoop Cluster Setup</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../dars/clearlinux/mkl/README.html#inside-the-running-container-we-need-to-edit-hadoop-configuration-files-as-follows">Inside the running container we need to edit hadoop configuration files as follows</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../dars/clearlinux/mkl/README.html#start-hadoop-daemons">Start Hadoop daemons</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../dars/clearlinux/mkl/README.html#single-node-spark-cluster-setup">Single Node Spark Cluster Setup</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../dars/clearlinux/mkl/README.html#run-the-pi-calculator-example-on-spark-shell">Run the Pi Calculator Example on spark-shell</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../dars/clearlinux/mkl/README.html#run-the-pi-calculator-example-on-pyspark">Run the Pi Calculator Example on pyspark</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../dars/clearlinux/mkl/README.html#deploy-dars-on-kubernetes">Deploy DARS on Kubernetes</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../dars/clearlinux/mkl/README.html#kubernetes-installation">Kubernetes installation</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../dars/clearlinux/mkl/README.html#faq"><strong>FAQ</strong></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../dars/clearlinux/mkl/licenses/README.html">Additional details on licenses</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="../../index.html">Database Reference Stack</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../index.html#overview">Overview</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../README.html">Database Reference Stack</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../releasenote.html">Database Reference Stack Release Note</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../releasenote.html#the-database-reference-stack-releases">The Database Reference Stack Releases</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../releasenote.html#the-database-reference-stack-with-cassandra">The Database Reference Stack with Cassandra</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../releasenote.html#the-database-reference-stack-with-redis">The Database Reference Stack with Redis</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../releasenote.html#the-database-reference-stack-with-memcached">The Database Reference Stack with Memcached</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../releasenote.html#how-to-get-the-database-reference-stack">How to get the Database Reference Stack</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../releasenote.html#licensing">Licensing</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../releasenote.html#working-with-the-database-reference-stack">Working with the Database Reference Stack</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../releasenote.html#contributing-to-the-database-reference-stack">Contributing to the Database Reference Stack</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../releasenote.html#reporting-security-issues">Reporting Security Issues</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../terms_of_use.html">Database Reference Stack Terms of Use</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../index.html#guide">Guide</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../dbrs.html">Database Reference Stack Guide</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../dbrs.html#overview">Overview</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../dbrs.html#releases">Releases</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../dbrs.html#hardware-requirements">Hardware Requirements</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../dbrs.html#firmware-configuration">Firmware configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../dbrs.html#hardware-configuration">Hardware Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../dbrs.html#running-dbrs-with-apache-cassandra">Running DBRS with Apache Cassandra*</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../dbrs.html#deploy-an-apache-cassandra-pmem-cluster-on-kubernetes">Deploy An Apache Cassandra-PMEM cluster on Kubernetes*</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../dbrs.html#running-dbrs-with-redis">Running DBRS with Redis</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../dbrs.html#running-dbrs-with-memcached">Running DBRS with Memcached</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2 current"><a class="reference internal" href="../../index.html#clear-linux-based-containers">Clear Linux based containers</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../redis/README.html">Database Reference Stack with Redis</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../redis/README.html#building-locally">Building Locally</a></li>
<li class="toctree-l4"><a class="reference internal" href="../redis/README.html#clone-the-repository">Clone the repository</a></li>
<li class="toctree-l4"><a class="reference internal" href="../redis/README.html#run-dbrs-redis-as-a-standalone-container">Run DBRS Redis as a standalone container</a></li>
<li class="toctree-l4"><a class="reference internal" href="../redis/README.html#deploy-dbrs-redis-cluster-on-kubernetes">Deploy DBRS Redis cluster on Kubernetes</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../redis/licenses/README.html">Additional details on licenses</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="../../index.html#apache-cassandra-versions">Apache Cassandra* versions</a><ul class="current">
<li class="toctree-l4 current"><a class="current reference internal" href="#">Database Reference Stack with Cassandra</a></li>
<li class="toctree-l4"><a class="reference internal" href="cassandra-pmem-helm/files/conf/README.html">Configuration files</a></li>
<li class="toctree-l4"><a class="reference internal" href="cassandra-pmem-helm/files/testProfiles/README.html">Test profiles</a></li>
<li class="toctree-l4"><a class="reference internal" href="licenses/README.html">Additional details on licenses</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../index.html#memcached-versions">memcached versions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../memcached/README.html">Memcached DBRS</a></li>
<li class="toctree-l4"><a class="reference internal" href="../memcached/licenses/README.html">Additional details on licenses</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../index.html#redis-versions">REDIS versions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../redis/README.html">Database Reference Stack with Redis</a></li>
<li class="toctree-l4"><a class="reference internal" href="../redis/licenses/README.html">Additional details on licenses</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../index.html#centos-based-containers">CentOS based containers</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../centos8/memcached/README.html">Memcached DBRS</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../centos8/memcached/README.html#build-dbrs-memcached-image">Build DBRS Memcached image</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../centos8/memcached/README.html#run-dbrs-memcached-as-a-standalone-container">Run DBRS Memcached as a standalone container</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../centos8/memcached/licenses/README.html">Additional details on licenses</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../mers/index.html">Media Reference Stack</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../mers/index.html#overview">Overview</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../mers/README.html">Media Reference Stack</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../mers/README.html#source-code">Source Code</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../mers/README.html#reporting-security-issues">Reporting Security Issues</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../mers/README.html#supported-platforms-and-media-codecs">Supported Platforms and Media Codecs</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../mers/releasenotes.html">Media Reference Stack Release Notes</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../mers/releasenotes.html#the-media-reference-stack">The Media Reference Stack</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../mers/releasenotes.html#licensing">Licensing</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../mers/releasenotes.html#the-media-reference-stack-licenses">The Media Reference Stack licenses</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../mers/releasenotes.html#disclaimer">Disclaimer</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../mers/releasenotes.html#source-code">Source code</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../mers/releasenotes.html#contributing-to-the-media-reference-stack">Contributing to the Media Reference Stack</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../mers/releasenotes.html#reporting-security-issues">Reporting Security Issues</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../mers/terms_of_use.html">Media Reference Stack Terms of Use</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../mers/index.html#guide">Guide</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../mers/mers.html">Media Reference Stack Guide</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../mers/mers.html#overview">Overview</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../mers/mers.html#releases">Releases</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../mers/mers.html#get-the-pre-built-mers-container-image">Get the pre-built MeRS container image</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../mers/mers.html#build-the-mers-container-image-from-source">Build the MeRS container image from source</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../mers/mers.html#use-the-mers-container-image">Use the MeRS container image</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../mers/mers.html#add-aom-support">Add AOM support</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../mers/index.html#clear-linux-based-containers">Clear Linux based containers</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../mers/clearlinux/INSTALL.html">Media Reference Stack</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../mers/clearlinux/INSTALL.html#building-locally">Building Locally</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../mers/clearlinux/INSTALL.html#pulling-from-docker-hub">Pulling from Docker Hub</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../mers/clearlinux/INSTALL.html#running-the-media-container">Running the Media Container</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../mers/clearlinux/INSTALL.html#run-examples">Run examples</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../hpcrs/index.html">High Performance Computing Reference Stack</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../hpcrs/index.html#overview">Overview</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../hpcrs/README.html">High Performance Compute Reference Stack</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../hpcrs/README.html#overview">Overview</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../hpcrs/README.html#releases">Releases</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../hpcrs/README.html#stack-features">Stack features</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../hpcrs/README.html#get-the-pre-built-hpcrs-container-image">Get the pre-built HPCRS container image</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../hpcrs/README.html#build-the-hpcrs-container-image-from-source">Build the HPCRS container image from source</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../hpcrs/README.html#use-the-hpcrs-container-image">Use the HPCRS container image</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../hpcrs/README.html#convert-the-hpcrs-image-to-a-singularity-image">Convert the HPCRS image to a Singularity image</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../hpcrs/README.html#reporting-security-issues">Reporting Security Issues</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../hpcrs/README.html#legal-notice">LEGAL NOTICE</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../hpcrs/NEWS.html">Release notes for HPCRS</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../hpcrs/NEWS.html#release-v0-1-0">Release <code class="docutils literal notranslate"><span class="pre">v0.1.0</span></code> :</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../hpcrs/terms_of_use.html">High Performance Computing Reference Stack Terms of Use</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../hpcrs/index.html#guides">Guides</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../hpcrs/d2s/Readme.html">d2s - A wrapper used to convert Docker images to Singularity images</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../hpcrs/d2s/Readme.html#version-compatibility">Version compatibility</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../hpcrs/d2s/Readme.html#install-singularity">Install Singularity</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../hpcrs/d2s/Readme.html#prerequisites">Prerequisites</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../hpcrs/d2s/Readme.html#download-compile-singularity">Download &amp; Compile <em>Singularity</em></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../hpcrs/d2s/Readme.html#source-bash-completion-file-optional">Source bash completion file (Optional)</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../hpcrs/docs/FAQ.html">HPCRS Frequently Asked Questions (FAQ)</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/intel/stacks">Project GitHub repository</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">System Stacks for Linux* OS</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content style-external-links">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../../index.html">Database Reference Stack</a> &raquo;</li>
        
      <li>Database Reference Stack with Cassandra</li>
    
    

  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="database-reference-stack-with-cassandra">
<h1>Database Reference Stack with Cassandra<a class="headerlink" href="#database-reference-stack-with-cassandra" title="Permalink to this headline">¶</a></h1>
<p><a class="reference external" href="http://microbadger.com/images/clearlinux/stacks-dbrs-cassandra"><img alt="https://images.microbadger.com/badges/image/clearlinux/stacks-dbrs-cassandra.svg" src="https://images.microbadger.com/badges/image/clearlinux/stacks-dbrs-cassandra.svg" /></a></p>
<div class="section" id="building-locally">
<h2>Building Locally<a class="headerlink" href="#building-locally" title="Permalink to this headline">¶</a></h2>
<p>The Dockerfiles for all Intel System Stacks container images are available at <a class="reference external" href="https://github.com/intel/stacks">stacks repository</a>. These can be used to build and modify the container images.</p>
<ol>
<li><p>Clone the intel/stacks repository.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>git clone https://github.com/intel/stacks.git
</pre></div>
</div>
</li>
<li><p>Change to the directory of the application:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span> stacks/dbrs/clearlinux/cassandra
</pre></div>
</div>
</li>
<li><p>Inside this repository there is a file called <code class="docutils literal notranslate"><span class="pre">scripts/build-cassandra-pmem.sh</span></code>, this script handles all the required procedures in rder to have cassandra-pmem compiled and ready for Dockerfile usage. The dependencies for this build can be installed with <code class="docutils literal notranslate"><span class="pre">swupd</span></code>.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>swupd bundle-add c-basic java-basic devpkg-pmdk pmdk
</pre></div>
</div>
</li>
<li><p>Once installed, we run the script</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./scripts/build-cassandra-pmem.sh
</pre></div>
</div>
</li>
<li><p>If everything runs sucessfully you will have a file called <code class="docutils literal notranslate"><span class="pre">cassandra-pmem-build.tar.gz</span></code> on the directory on which you run the script, this file should be placed in the same directory of the Dockerfile for this one to be able to build the docker image sucesfully. Default build args in Docker are on: https://docs.docker.com/engine/reference/builder/#arg</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>docker build --no-cache -t clearlinux/stacks-dbrs-cassandra .
</pre></div>
</div>
</li>
</ol>
</div>
<div class="section" id="run-dbrs-cassandra-as-a-standalone-container">
<h2>Run DBRS Cassandra as a standalone container<a class="headerlink" href="#run-dbrs-cassandra-as-a-standalone-container" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>PMEM memory in <code class="docutils literal notranslate"><span class="pre">devdax</span></code> or <code class="docutils literal notranslate"><span class="pre">fsdax</span></code>  mode, the container image is able to handle both modes and depending on the PMEM mode, the mount points inside the container should be different.</p></li>
</ul>
<p>In order to make available <code class="docutils literal notranslate"><span class="pre">devdax</span></code> pmem devices inside the container you must use the <code class="docutils literal notranslate"><span class="pre">--device</span></code> directive, internally the container always uses <code class="docutils literal notranslate"><span class="pre">/dev/dax0.0</span></code>, so the mapping should be:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">--</span><span class="n">device</span><span class="o">=/</span><span class="n">dev</span><span class="o">/&lt;</span><span class="n">host</span><span class="o">-</span><span class="n">device</span><span class="o">&gt;</span><span class="p">:</span><span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">dax0</span><span class="o">.</span><span class="mi">0</span>
</pre></div>
</div>
<p>In a similar fashion for <code class="docutils literal notranslate"><span class="pre">fsdax</span></code> we need the device to be mapped to <code class="docutils literal notranslate"><span class="pre">/mnt/pmem</span></code> inside the container:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">--</span><span class="n">mount</span> <span class="nb">type</span><span class="o">=</span><span class="n">bind</span><span class="p">,</span><span class="n">source</span><span class="o">=&lt;</span><span class="n">source</span><span class="o">-</span><span class="n">mount</span><span class="o">-</span><span class="n">point</span><span class="o">&gt;</span><span class="p">,</span><span class="n">target</span><span class="o">=/</span><span class="n">mnt</span><span class="o">/</span><span class="n">pmem</span>
</pre></div>
</div>
<div class="section" id="preparing-pmem-for-container-use">
<h3>Preparing PMEM for container use<a class="headerlink" href="#preparing-pmem-for-container-use" title="Permalink to this headline">¶</a></h3>
<p>In the current state, the cassandra-pmem image is capable of using both <code class="docutils literal notranslate"><span class="pre">fsdax</span></code> and <code class="docutils literal notranslate"><span class="pre">devdax</span></code>, the necessary steps to configure the PMEM to work with cassandra are documented here.</p>
<div class="section" id="fsdax-mode">
<h4>fsdax mode<a class="headerlink" href="#fsdax-mode" title="Permalink to this headline">¶</a></h4>
<p>First we need to verify that our PMEM is on <code class="docutils literal notranslate"><span class="pre">fsdax</span></code> mode</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># ndctl list -u</span>
<span class="p">{</span>
  <span class="s2">&quot;dev&quot;</span><span class="p">:</span><span class="s2">&quot;namespace0.0&quot;</span><span class="p">,</span>
  <span class="s2">&quot;mode&quot;</span><span class="p">:</span><span class="s2">&quot;fsdax&quot;</span><span class="p">,</span>
  <span class="s2">&quot;map&quot;</span><span class="p">:</span><span class="s2">&quot;mem&quot;</span><span class="p">,</span>
  <span class="s2">&quot;size&quot;</span><span class="p">:</span><span class="s2">&quot;4.00 GiB (4.29 GB)&quot;</span><span class="p">,</span>
  <span class="s2">&quot;sector_size&quot;</span><span class="p">:</span><span class="mi">512</span><span class="p">,</span>
  <span class="s2">&quot;blockdev&quot;</span><span class="p">:</span><span class="s2">&quot;pmem0&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>if for some reason the device is not on <code class="docutils literal notranslate"><span class="pre">fsdax</span></code> mode you can run <code class="docutils literal notranslate"><span class="pre">ndctl</span> <span class="pre">create-namespace</span> <span class="pre">-fe</span> <span class="pre">&lt;namespace-name&gt;</span>&#160; <span class="pre">--mode=fsdax</span></code> to reconfigure the namespace to the desired mode.
Once the PMEM namespace is configured, a device named <code class="docutils literal notranslate"><span class="pre">/dev/pmem{0-9}</span></code> should appear then we need to proceed to create a filesystem on it. The filesystem could be <code class="docutils literal notranslate"><span class="pre">ext4</span></code> or <code class="docutils literal notranslate"><span class="pre">xfs</span></code>, for this example we are going to use <code class="docutils literal notranslate"><span class="pre">ext4</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># mkfs.ext4 /dev/pmem0</span>
<span class="n">mke2fs</span> <span class="mf">1.45</span><span class="o">.</span><span class="mi">2</span> <span class="p">(</span><span class="mi">27</span><span class="o">-</span><span class="n">May</span><span class="o">-</span><span class="mi">2019</span><span class="p">)</span>
<span class="n">Creating</span> <span class="n">filesystem</span> <span class="k">with</span> <span class="mi">1031680</span> <span class="mi">4</span><span class="n">k</span> <span class="n">blocks</span> <span class="ow">and</span> <span class="mi">258048</span> <span class="n">inodes</span>
<span class="n">Filesystem</span> <span class="n">UUID</span><span class="p">:</span> <span class="mi">303</span><span class="n">c03f5</span><span class="o">-</span><span class="n">ac4e</span><span class="o">-</span><span class="mi">4462</span><span class="o">-</span><span class="mi">8</span><span class="n">bf9</span><span class="o">-</span><span class="n">bc6b0fae53fe</span>
<span class="n">Superblock</span> <span class="n">backups</span> <span class="n">stored</span> <span class="n">on</span> <span class="n">blocks</span><span class="p">:</span>
	<span class="mi">32768</span><span class="p">,</span> <span class="mi">98304</span><span class="p">,</span> <span class="mi">163840</span><span class="p">,</span> <span class="mi">229376</span><span class="p">,</span> <span class="mi">294912</span><span class="p">,</span> <span class="mi">819200</span><span class="p">,</span> <span class="mi">884736</span>

<span class="n">Allocating</span> <span class="n">group</span> <span class="n">tables</span><span class="p">:</span> <span class="n">done</span>
<span class="n">Writing</span> <span class="n">inode</span> <span class="n">tables</span><span class="p">:</span> <span class="n">done</span>
<span class="n">Creating</span> <span class="n">journal</span> <span class="p">(</span><span class="mi">16384</span> <span class="n">blocks</span><span class="p">):</span> <span class="n">done</span>
<span class="n">Writing</span> <span class="n">superblocks</span> <span class="ow">and</span> <span class="n">filesystem</span> <span class="n">accounting</span> <span class="n">information</span><span class="p">:</span> <span class="n">done</span>
</pre></div>
</div>
<p>Once the filesystem was created, we need to mount it with the dax option</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mount /dev/pmem0 /mnt/pmem -o dax
</pre></div>
</div>
<p>When using <code class="docutils literal notranslate"><span class="pre">fsdax</span></code> mode cassandra-pmem creates a pool file on the pmem mountpoint, so the <code class="docutils literal notranslate"><span class="pre">jvm.options</span></code> configuration should look like the text below:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">Dpmem_path</span><span class="o">=/</span><span class="n">mnt</span><span class="o">/</span><span class="n">pmem</span><span class="o">/</span><span class="n">cassandra_pool</span>
<span class="o">-</span><span class="n">Dpool_size</span><span class="o">=</span><span class="mi">3221225472</span>
</pre></div>
</div>
<p>Where</p>
<ul class="simple">
<li><p>pmem_path is the path to the pool file, which should include the path itself and the file name</p></li>
<li><p>pool_size is the size of the pool file in bytes, if you are using the docker images provided here you can pass this value as an environment variable to the container runtime in Gb and the calculation is done automatically.</p></li>
</ul>
<p>Is important to notice is that when creating the filesystem in the pmem device certain amount of space of the device is used by the filesystem metadata so the pool_size should be smaller than the total pmem namespace size.
When using the docker image provided here, the file <code class="docutils literal notranslate"><span class="pre">jvm.options</span></code> is automatically populated with the environment variables <code class="docutils literal notranslate"><span class="pre">CASSANDRA_PMEM_POOL_NAME</span></code> and <code class="docutils literal notranslate"><span class="pre">CASSANDRA_FSDAX_POOL_SIZE_GB</span></code>.</p>
</div>
<div class="section" id="devdax-mode">
<h4>devdax mode<a class="headerlink" href="#devdax-mode" title="Permalink to this headline">¶</a></h4>
<p>We need to verify if the device we want to use is in <code class="docutils literal notranslate"><span class="pre">devdax</span></code> mode</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">root</span><span class="nd">@clear</span><span class="o">-</span><span class="n">pmem</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">development</span> <span class="c1"># ndctl create-namespace -fe namespace0.0  --mode=devdax</span>
<span class="p">{</span>
  <span class="s2">&quot;dev&quot;</span><span class="p">:</span><span class="s2">&quot;namespace0.0&quot;</span><span class="p">,</span>
  <span class="s2">&quot;mode&quot;</span><span class="p">:</span><span class="s2">&quot;devdax&quot;</span><span class="p">,</span>
  <span class="s2">&quot;map&quot;</span><span class="p">:</span><span class="s2">&quot;dev&quot;</span><span class="p">,</span>
  <span class="s2">&quot;size&quot;</span><span class="p">:</span><span class="s2">&quot;3.94 GiB (4.23 GB)&quot;</span><span class="p">,</span>
  <span class="s2">&quot;uuid&quot;</span><span class="p">:</span><span class="s2">&quot;cb738cc7-711d-4578-bebf-1f7ba02ca169&quot;</span><span class="p">,</span>
  <span class="s2">&quot;daxregion&quot;</span><span class="p">:{</span>
    <span class="s2">&quot;id&quot;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
    <span class="s2">&quot;size&quot;</span><span class="p">:</span><span class="s2">&quot;3.94 GiB (4.23 GB)&quot;</span><span class="p">,</span>
    <span class="s2">&quot;align&quot;</span><span class="p">:</span><span class="mi">2097152</span><span class="p">,</span>
    <span class="s2">&quot;devices&quot;</span><span class="p">:[</span>
      <span class="p">{</span>
        <span class="s2">&quot;chardev&quot;</span><span class="p">:</span><span class="s2">&quot;dax0.0&quot;</span><span class="p">,</span>
        <span class="s2">&quot;size&quot;</span><span class="p">:</span><span class="s2">&quot;3.94 GiB (4.23 GB)&quot;</span>
      <span class="p">}</span>
    <span class="p">]</span>
  <span class="p">},</span>
  <span class="s2">&quot;align&quot;</span><span class="p">:</span><span class="mi">2097152</span>
<span class="p">}</span>
</pre></div>
</div>
<p>if not, we can reconfigure it using <code class="docutils literal notranslate"><span class="pre">ndctl</span> <span class="pre">create-namespace</span> <span class="pre">-fe</span> <span class="pre">&lt;namespace-name&gt;</span>&#160; <span class="pre">--mode=devdax</span></code>. Before using a <code class="docutils literal notranslate"><span class="pre">devdax</span></code> device we need to clear the device:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">root</span><span class="nd">@clear</span><span class="o">-</span><span class="n">pmem</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">development</span> <span class="c1"># pmempool rm -vaf /dev/dax0.0</span>
<span class="n">removed</span> <span class="s1">&#39;/dev/dax0.0&#39;</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">jvm.options</span></code> configuration for cassandra should look like the following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">Dpmem_path</span><span class="o">=/</span><span class="n">dev</span><span class="o">/</span><span class="n">dax0</span><span class="o">.</span><span class="mi">0</span>
<span class="o">-</span><span class="n">Dpool_size</span><span class="o">=</span><span class="mi">0</span>
</pre></div>
</div>
<p>Where</p>
<ul class="simple">
<li><p>pmem_path is the <code class="docutils literal notranslate"><span class="pre">devdax</span></code> device.</p></li>
<li><p>pool_size=0 indicates to use the entire <code class="docutils literal notranslate"><span class="pre">devdax</span></code> device.</p></li>
</ul>
<p>When using the docker image provided here, the file <code class="docutils literal notranslate"><span class="pre">jvm.options</span></code> is automatically populated.</p>
</div>
</div>
<div class="section" id="start-container">
<h3>Start container<a class="headerlink" href="#start-container" title="Permalink to this headline">¶</a></h3>
<p>In <code class="docutils literal notranslate"><span class="pre">devdax</span></code> mode:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>docker run --device<span class="o">=</span>/&lt;devdax-device&gt;:/dev/dax0.0 --ulimit <span class="nv">nofile</span><span class="o">=</span><span class="m">262144</span>:262144 -p <span class="m">9042</span>:9042 -p <span class="m">7000</span>:7000 -it --name cassandra-test &lt;image-id&gt;
</pre></div>
</div>
<p>In <code class="docutils literal notranslate"><span class="pre">fsdax</span></code> mode:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>docker run --mount <span class="nv">type</span><span class="o">=</span>bind,source<span class="o">=</span>/&lt;fsdax-mountpoint&gt;,target<span class="o">=</span>/mnt/pmem  --ulimit <span class="nv">nofile</span><span class="o">=</span><span class="m">262144</span>:262144 -p <span class="m">9042</span>:9042 -p <span class="m">7000</span>:7000 -it -e <span class="s1">&#39;CASSANDRA_FSDAX_POOL_SIZE_GB=&lt;fsdax-pool-size-in-gb&gt;&#39;</span> --name cassandra-test &lt;image-id&gt;
</pre></div>
</div>
</div>
<div class="section" id="configure-container">
<h3>Configure container<a class="headerlink" href="#configure-container" title="Permalink to this headline">¶</a></h3>
<div class="section" id="using-environment-variables">
<h4>Using environment variables<a class="headerlink" href="#using-environment-variables" title="Permalink to this headline">¶</a></h4>
<p>By default the container listens on the primary container IP address, but if required, some parameters can be provided as environment variables using <code class="docutils literal notranslate"><span class="pre">--env</span></code>.</p>
<table border="1" class="docutils">
<thead>
<tr>
<th><strong>Environment Variable</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><code>CASSANDRA_CLUSTER_NAME</code></td>
<td>Cassandra cluster name, by default <code>Cassandra Cluster</code></td>
</tr>
<tr>
<td><code>CASSANDRA_LISTEN_ADDRESS</code></td>
<td>Cassandra listen address</td>
</tr>
<tr>
<td><code>CASSANDRA_RPC_ADDRESS</code></td>
<td>Cassandra RPC address</td>
</tr>
<tr>
<td><code>CASSANDRA_SEED_ADDRESSES</code></td>
<td>A comma separated list of hosts in the cluster, if not provided, cassandra is going to run as a single node.</td>
</tr>
<tr>
<td><code>CASSANDRA_SNITCH</code></td>
<td>The snitch type for the cluster, by default it is <code>SimpleSnitch</code>, for more complex snitches you can mount your own <code>cassandra-rackdc.properties</code> file.</td>
</tr>
<tr>
<td><code>LOCAL_JMX</code></td>
<td>If set to <code>no</code> the JMX service will listen on all IP addresses, the default is <code>yes</code> and listens just on localhost 127.0.0.1</td>
</tr>
<tr>
<td><code>JVM_OPTS</code></td>
<td>When set you can pass additional arguments to the JVM for cassandra execution, for example for specifying memory heap sizes <code>JVM_OPTS=-Xms16G -Xmx16G -Xmn12G</code></td>
</tr>
</tbody>
</table><p>When using PMEM in <code class="docutils literal notranslate"><span class="pre">fsdax</span></code> mode, there are some parameters to control the allocation of memory:</p>
<table border="1" class="docutils">
<thead>
<tr>
<th>Environment Variable</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>CASSANDRA_FSDAX_POOL_SIZE_GB</code></td>
<td>The size of the fsdax pool in GB, if it is not specified the pool size is <code>1</code></td>
</tr>
<tr>
<td><code>CASSANDRA_PMEM_POOL_NAME</code></td>
<td>The filename of the pool created in PMEM, by default <code>cassandra_pool</code></td>
</tr>
</tbody>
</table></div>
<div class="section" id="using-custom-files">
<h4>Using custom files<a class="headerlink" href="#using-custom-files" title="Permalink to this headline">¶</a></h4>
<p>For more complex deployments it is also possible to provide custom <code class="docutils literal notranslate"><span class="pre">cassandra.yaml</span></code> and <code class="docutils literal notranslate"><span class="pre">jvm.options</span></code> files as shown below:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">run</span> <span class="o">--</span><span class="n">mount</span> <span class="nb">type</span><span class="o">=</span><span class="n">bind</span><span class="p">,</span><span class="n">source</span><span class="o">=/&lt;</span><span class="n">fsdax</span><span class="o">-</span><span class="n">mountpoint</span><span class="o">&gt;</span><span class="p">,</span><span class="n">target</span><span class="o">=/</span><span class="n">mnt</span><span class="o">/</span><span class="n">pmem</span> <span class="o">-</span><span class="n">it</span>  <span class="o">--</span><span class="n">ulimit</span> <span class="n">nofile</span><span class="o">=</span><span class="mi">262144</span><span class="p">:</span><span class="mi">262144</span> <span class="o">--</span><span class="n">mount</span> <span class="nb">type</span><span class="o">=</span><span class="n">bind</span><span class="p">,</span><span class="n">source</span><span class="o">=/&lt;</span><span class="n">path</span><span class="o">-</span><span class="n">to</span><span class="o">-</span><span class="n">file</span><span class="o">&gt;/</span><span class="n">cassandra</span><span class="o">.</span><span class="n">yaml</span><span class="p">,</span><span class="n">target</span><span class="o">=/</span><span class="n">workspace</span><span class="o">/</span><span class="n">cassandra</span><span class="o">/</span><span class="n">conf</span><span class="o">/</span><span class="n">cassandra</span><span class="o">.</span><span class="n">yaml</span> <span class="o">--</span><span class="n">mount</span> <span class="nb">type</span><span class="o">=</span><span class="n">bind</span><span class="p">,</span><span class="n">source</span><span class="o">=/</span><span class="n">path</span><span class="o">-</span><span class="n">to</span><span class="o">-</span><span class="n">file</span><span class="o">&gt;/</span><span class="n">jvm</span><span class="o">.</span><span class="n">options</span><span class="p">,</span><span class="n">target</span><span class="o">=/</span><span class="n">workspace</span><span class="o">/</span><span class="n">cassandra</span><span class="o">/</span><span class="n">conf</span><span class="o">/</span><span class="n">jvm</span><span class="o">.</span><span class="n">options</span> <span class="o">--</span><span class="n">name</span> <span class="n">cassandra</span><span class="o">-</span><span class="n">custom</span><span class="o">-</span><span class="n">files</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="clustering">
<h3>Clustering<a class="headerlink" href="#clustering" title="Permalink to this headline">¶</a></h3>
<p>For a simple two node cluster using PMEM in <code class="docutils literal notranslate"><span class="pre">fsdax</span></code> mode on both containers:</p>
<div class="section" id="node-1">
<h4>Node 1<a class="headerlink" href="#node-1" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>IP: 172.17.0.2</p></li>
<li><p>PMEM mountpoint: /mnt/pmem1</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">run</span> <span class="o">--</span><span class="n">mount</span> <span class="nb">type</span><span class="o">=</span><span class="n">bind</span><span class="p">,</span><span class="n">source</span><span class="o">=/</span><span class="n">mnt</span><span class="o">/</span><span class="n">pmem1</span><span class="p">,</span><span class="n">target</span><span class="o">=/</span><span class="n">mnt</span><span class="o">/</span><span class="n">pmem</span>  <span class="o">--</span><span class="n">ulimit</span> <span class="n">nofile</span><span class="o">=</span><span class="mi">262144</span><span class="p">:</span><span class="mi">262144</span> <span class="o">-</span><span class="n">it</span> <span class="o">-</span><span class="n">e</span> <span class="s1">&#39;CASSANDRA_FSDAX_POOL_SIZE_GB=2&#39;</span> <span class="o">-</span><span class="n">e</span> <span class="s1">&#39;CASSANDRA_SEED_ADDRESSES=172.17.0.2:7000,172.17.0.3:7000&#39;</span>  <span class="o">--</span><span class="n">name</span> <span class="n">cassandra</span><span class="o">-</span><span class="n">node1</span> <span class="o">&lt;</span><span class="n">image</span><span class="o">-</span><span class="nb">id</span><span class="o">&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="node-2">
<h4>Node 2<a class="headerlink" href="#node-2" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>IP: 172.17.0.3</p></li>
<li><p>PMEM mountpoint: /mnt/pmem2</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">run</span> <span class="o">--</span><span class="n">mount</span> <span class="nb">type</span><span class="o">=</span><span class="n">bind</span><span class="p">,</span><span class="n">source</span><span class="o">=/</span><span class="n">mnt</span><span class="o">/</span><span class="n">pmem2</span><span class="p">,</span><span class="n">target</span><span class="o">=/</span><span class="n">mnt</span><span class="o">/</span><span class="n">pmem</span>  <span class="o">--</span><span class="n">ulimit</span> <span class="n">nofile</span><span class="o">=</span><span class="mi">262144</span><span class="p">:</span><span class="mi">262144</span> <span class="o">-</span><span class="n">it</span> <span class="o">-</span><span class="n">e</span> <span class="s1">&#39;CASSANDRA_FSDAX_POOL_SIZE_GB=2&#39;</span> <span class="o">-</span><span class="n">e</span> <span class="s1">&#39;CASSANDRA_SEED_ADDRESSES=172.17.0.2:7000,172.17.0.3:7000&#39;</span>  <span class="o">--</span><span class="n">name</span> <span class="n">cassandra</span><span class="o">-</span><span class="n">node2</span> <span class="o">&lt;</span><span class="n">image</span><span class="o">-</span><span class="nb">id</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Once both nodes are running eventually the gossip is settled and we can use <code class="docutils literal notranslate"><span class="pre">nodetool</span></code> on any of both containers to check cluster status.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">exec</span> <span class="o">-</span><span class="n">it</span> <span class="o">&lt;</span><span class="n">container</span><span class="o">-</span><span class="nb">id</span><span class="o">&gt;</span> <span class="n">bash</span> <span class="o">/</span><span class="n">workspace</span><span class="o">/</span><span class="n">cassandra</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">nodetool</span> <span class="n">status</span>
</pre></div>
</div>
<p>The output should look similar to this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Datacenter</span><span class="p">:</span> <span class="n">datacenter1</span>
<span class="o">=======================</span>
<span class="n">Status</span><span class="o">=</span><span class="n">Up</span><span class="o">/</span><span class="n">Down</span>
<span class="o">|/</span> <span class="n">State</span><span class="o">=</span><span class="n">Normal</span><span class="o">/</span><span class="n">Leaving</span><span class="o">/</span><span class="n">Joining</span><span class="o">/</span><span class="n">Moving</span>
<span class="o">--</span>  <span class="n">Address</span>     <span class="n">Load</span>       <span class="n">Tokens</span>       <span class="n">Owns</span> <span class="p">(</span><span class="n">effective</span><span class="p">)</span>  <span class="n">Host</span> <span class="n">ID</span>                               <span class="n">Rack</span>
<span class="n">UN</span>  <span class="mf">172.17</span><span class="o">.</span><span class="mf">0.3</span>  <span class="mi">0</span> <span class="nb">bytes</span>    <span class="mi">256</span>          <span class="mf">100.0</span><span class="o">%</span>            <span class="mi">22387159</span><span class="o">-</span><span class="mi">8192</span><span class="o">-</span><span class="mi">41</span><span class="n">cf</span><span class="o">-</span><span class="mi">8</span><span class="n">b6c</span><span class="o">-</span><span class="mi">8</span><span class="n">bf0e1049eb7</span>  <span class="n">rack1</span>
<span class="n">UN</span>  <span class="mf">172.17</span><span class="o">.</span><span class="mf">0.2</span>  <span class="mi">0</span> <span class="nb">bytes</span>    <span class="mi">256</span>          <span class="mf">100.0</span><span class="o">%</span>            <span class="mi">219</span><span class="n">b56ba</span><span class="o">-</span><span class="n">c07c</span><span class="o">-</span><span class="mi">400</span><span class="n">b</span><span class="o">-</span><span class="n">a018</span><span class="o">-</span><span class="n">a5dc20edeb09</span>  <span class="n">rack1</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="data-persistence">
<h3>Data persistence<a class="headerlink" href="#data-persistence" title="Permalink to this headline">¶</a></h3>
<p>By default the data written to cassandra can be accessed as long as the container exists. In order to persist the data a user can mount volumes or bind mounts on <code class="docutils literal notranslate"><span class="pre">/workspace/cassandra/data</span></code> and <code class="docutils literal notranslate"><span class="pre">/workspace/cassandra/logs</span></code>, in this way the data can still be accessed once the container is deleted.</p>
</div>
</div>
<div class="section" id="deploy-dbrs-cassandra-cluster-on-kubernetes">
<h2>Deploy DBRS Cassandra cluster on Kubernetes<a class="headerlink" href="#deploy-dbrs-cassandra-cluster-on-kubernetes" title="Permalink to this headline">¶</a></h2>
<p>Many containerized workloads are deployed in clusters and orchestration software like Kubernetes, for this purpose the Helm chart located on <code class="docutils literal notranslate"><span class="pre">cassandra-pmem-helm</span></code> can be useful.</p>
<div class="section" id="kubernetes-installation">
<h3>Kubernetes installation<a class="headerlink" href="#kubernetes-installation" title="Permalink to this headline">¶</a></h3>
<p>To install Kubernetes in Clear Linux, follow the instructions in the Clear Linux’s <a class="reference external" href="https://docs.01.org/clearlinux/latest/tutorials/kubernetes.html">Kubernetes Tutorial</a></p>
<p>After setting up Kubernetes, you will need to enable it to support DCPMM suing the pmem-csi driver. To install the driver follow the instructions in the <a class="reference external" href="https://github.com/intel/pmem-csi">pmem-csi repository</a> file.</p>
<p>Then Kubernetes cluster must have <a class="reference external" href="https://helm.sh/">helm and tiller</a> installed in order for the helm chart to deploy.</p>
</div>
<div class="section" id="helm-chart-configuration">
<h3>Helm chart configuration<a class="headerlink" href="#helm-chart-configuration" title="Permalink to this headline">¶</a></h3>
<p>In order to configure the cassandra pmem cluster some variables and values are provided. This values are set on <code class="docutils literal notranslate"><span class="pre">cassandra-pmem-helm/values.yaml</span></code>, those can also be modified according to your specific needs. A summary of those parameters is shown below:</p>
<table border="1" class="docutils">
<thead>
<tr>
<th><strong>Value</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>clusterName</td>
<td>The cluster Name set across all deployed nodes</td>
</tr>
<tr>
<td>replicaCount</td>
<td>The number of nodes in the cluster to be deployed</td>
</tr>
<tr>
<td>image.repository</td>
<td>The address of the container registry where the cassandra-pmem image should be pulled</td>
</tr>
<tr>
<td>image.tag</td>
<td>The tag of the image to be pulled during deployment</td>
</tr>
<tr>
<td>image.name</td>
<td>The name of the image to be pulled during deployment</td>
</tr>
<tr>
<td>pmem.containerPmemAllocation</td>
<td>The size of the persistent volume claim to be used as heap, it uses the storage class <code>pmem-csi-sc-ext4</code> from pmem-csi</td>
</tr>
<tr>
<td>pmem.fsdaxPoolSizeInGB</td>
<td>The size of the fsdax pool to be created inside the persistent volume claim, in practice it shuld be <code>1G</code> less than pmem.containerPmemAllocation</td>
</tr>
<tr>
<td>enablePersistence</td>
<td>If set to <code>true</code> K8s persistent volumes are deployed to store data and logs</td>
</tr>
<tr>
<td>persistentVolumes.logsVolumeSize</td>
<td>The size of the persistent volume used for storing logs on each node, the default is <code>4G</code></td>
</tr>
<tr>
<td>persistentVolumes.dataVolumeSize</td>
<td>The size of the persistent volume used for storing data on each node, the default is <code>4G</code></td>
</tr>
<tr>
<td>persistentVolumes.logsStorageClass</td>
<td>K8s storage class used by  the logs pvc</td>
</tr>
<tr>
<td>persistentVolumes.dataStorageClass</td>
<td>K8s storage class used by  the data pvc</td>
</tr>
<tr>
<td>provideCustomConfig</td>
<td>If set to <code>true</code>, it mounts all the files located on <code>&lt;helm-chart-dir&gt;/files/conf</code> on <code>/workspace/cassandra/conf</code> inside each container in order to provide a way to customize the deployment beyond the options provided here</td>
</tr>
<tr>
<td>exposeJmxPort</td>
<td>When set to <code>true</code> it exposes the JMX port as part of the kubernetes headless service, it should be used together with <code>enableAdditionalFilesConfigMap</code> in order to provide authentication files needed for JMX when the remote connections are allowed, when set to <code>false</code> only local access through 127.0.0.1 is granted and no additional authentication is needed</td>
</tr>
<tr>
<td>enableClientToolsPod</td>
<td>If set to <code>true</code>, an additional pod independent from the cluster is deployed, this pod contains various Cassandra client tools and mounts test profiles located under <code>&lt;helm-chart-dir&gt;/files/testProfiles</code> to <code>/testProfiles</code> inside the pod. This pod is useful to test and launch benchmarks</td>
</tr>
<tr>
<td>enableAdditionalFilesConfigMap</td>
<td>When set to true, it takes the files located in <code>&lt;helm-chart-dir&gt;/files/additionalFiles</code> and mount them in <code>/etc/cassandra</code> inside the pods, some additional files for cassandra can be stored here, such as JMX auth files</td>
</tr>
<tr>
<td>jvmOpts.enabled</td>
<td>If set to <code>true</code> the environment variable <code>JVM_OPTS</code> is overriden with the value provided on jvmOpts.value</td>
</tr>
<tr>
<td>jvmOpts.value</td>
<td>Sets the value of the environment variable <code>JVM_OPTS</code>, in this way some java runtime configurations can be provided such as RAM heap usage</td>
</tr>
<tr>
<td>resources.enabled</td>
<td>if set to <code>true</code>, the resource constraints are set on each pod using the values under resources.requests and resources.limits</td>
</tr>
<tr>
<td>resources.requests.memory and resources.request.cpu</td>
<td>Initial resource allocation for each pod in the cluster</td>
</tr>
<tr>
<td>resources.limits.memory and resources.limits.cpu</td>
<td>Limits for cpu and memory for each pod in the cluster</td>
</tr>
</tbody>
</table><p>** <strong>Important considerations when selecting volume sizes</strong> **</p>
<p>When selecting the <code class="docutils literal notranslate"><span class="pre">fsdax</span></code> pool file size, it is important to consider that when requesting a volume, certain amount of space is used by the filesystem metadata on that volume, therefore the available space turns out to be less than total amount specified, taking this into consideration the size of the fsdax pool file should be ~2G less than the total volume size requested.</p>
</div>
<div class="section" id="helm-chart-deployment">
<h3>Helm chart deployment<a class="headerlink" href="#helm-chart-deployment" title="Permalink to this headline">¶</a></h3>
<p>Once all the configurations are set, to install the chart inside a given Kubernetes cluster you must run:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>helm install ./cassandra-pmem-helm
</pre></div>
</div>
<p>Eventually all the given nodes will be shown as running using <code class="docutils literal notranslate"><span class="pre">kubectl</span> <span class="pre">get</span> <span class="pre">pods</span></code>.</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="cassandra-pmem-helm/files/conf/README.html" class="btn btn-neutral float-right" title="Configuration files" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../redis/licenses/README.html" class="btn btn-neutral float-left" title="Additional details on licenses" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>